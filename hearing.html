<script>
const API_BASE = "https://allnspyre-api.vercel.app";

async function loadAreas(plan, prefs) {
  const container = document.getElementById("area-options");
  container.innerHTML = "";

  if (!prefs || prefs.length === 0) {
    container.innerHTML = '<div style="color:red;">pref is required</div>';
    return;
  }

  try {
    const prefQuery = prefs.map(p => `pref=${encodeURIComponent(p)}`).join("&");
    const url = `${API_BASE}/api/areas?plan=${encodeURIComponent(plan)}&${prefQuery}`;

    const res = await fetch(url, { cache: "no-store" });
    const data = await res.json();

    if (!data.ok || !data.areaGroups || data.areaGroups.length === 0) {
      container.innerHTML = '<div style="color:red;">No areas found for this selection.</div>';
      return;
    }

    data.areaGroups.forEach(group => {
      const btn = document.createElement("button");
      btn.className = "area-btn";
      btn.textContent = group;
      btn.onclick = () => toggleArea(btn, group);
      container.appendChild(btn);
    });

  } catch (e) {
    container.innerHTML = '<div style="color:red;">Failed to load areas.</div>';
  }
}
</script>
