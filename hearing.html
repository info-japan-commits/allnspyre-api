<script>
(function () {
  function getPlan() {
    const qs = new URLSearchParams(location.search);
    return (qs.get("plan") || "explorer").toLowerCase();
  }

  // できるだけ広く「エリアの選択値」を拾う（Select / Radio両対応）
  function pickAreaDetails() {
    // 1) よくあるID
    const byId =
      document.querySelector("#areaDetails") ||
      document.querySelector("#area_detail") ||
      document.querySelector("#areaDetail") ||
      document.querySelector("#area");

    if (byId && byId.value) return String(byId.value).trim();

    // 2) select の name
    const sel =
      document.querySelector('select[name="areaDetails"]') ||
      document.querySelector('select[name="area_detail"]') ||
      document.querySelector('select[name="area"]');

    if (sel && sel.value) return String(sel.value).trim();

    // 3) radio の name
    const radio =
      document.querySelector('input[type="radio"][name="areaDetails"]:checked') ||
      document.querySelector('input[type="radio"][name="area_detail"]:checked') ||
      document.querySelector('input[type="radio"][name="area"]:checked');

    if (radio && radio.value) return String(radio.value).trim();

    // 4) data属性
    const dataSel =
      document.querySelector('[data-area-details]') ||
      document.querySelector('[data-area-detail]');

    if (dataSel) {
      const v = dataSel.getAttribute("data-area-details") || dataSel.getAttribute("data-area-detail");
      if (v) return String(v).trim();
    }

    return "";
  }

  // 「次へ」ボタンっぽいものを拾う（IDが違っても動く）
  function findSubmitButton() {
    return (
      document.querySelector("#continueBtn") ||
      document.querySelector("#submitBtn") ||
      document.querySelector('button[type="submit"]') ||
      document.querySelector('button[data-submit]') ||
      document.querySelector('button')
    );
  }

  function goCheckout() {
    const plan = getPlan();
    const areaDetails = pickAreaDetails();

    if (!areaDetails) {
      alert("Please select an area.");
      return;
    }

    // ✅ hearing完了後は pay.html に送る（ここが肝）
    const url = `/pay.html?plan=${encodeURIComponent(plan)}&areaDetails=${encodeURIComponent(areaDetails)}`;
    location.href = url;
  }

  // ボタンにクリックを紐づける
  const btn = findSubmitButton();
  if (btn) {
    btn.addEventListener("click", function (e) {
      e.preventDefault();
      goCheckout();
    });
  }

  // form submit でも拾う（スマホのEnter等）
  const form = document.querySelector("form");
  if (form) {
    form.addEventListener("submit", function (e) {
      e.preventDefault();
      goCheckout();
    });
  }
})();
</script>
