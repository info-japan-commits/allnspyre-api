<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Checkout</title>
  <style>
    body{margin:0;background:#fafafa;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:#111}
    .wrap{max-width:720px;margin:0 auto;padding:40px 20px 80px}
    h1{margin:0 0 10px;font-size:32px}
    .sub{margin:0 0 22px;color:#666;line-height:1.6}
    .card{background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.06);padding:18px 18px;margin:14px 0}
    .row{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .k{color:#666}
    .v{font-weight:700}
    .btn{width:100%;border:1px solid rgba(0,0,0,.12);background:#111;color:#fff;border-radius:14px;padding:14px 16px;font-weight:800;cursor:pointer;font-size:16px}
    .btn.secondary{background:#fff;color:#111;margin-top:10px}
    .mini{font-size:12px;color:#777;margin-top:10px;line-height:1.5}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Almost there.</h1>
    <p class="sub">Confirm your intent, then proceed to secure checkout.</p>

    <div class="card">
      <div class="row"><div class="k">Plan</div><div class="v" id="plan"></div></div>
      <div class="row"><div class="k">Prefecture</div><div class="v" id="pref"></div></div>
      <div class="row"><div class="k">Area</div><div class="v" id="areas"></div></div>
      <div class="row"><div class="k">Who</div><div class="v" id="who"></div></div>
      <div class="row"><div class="k">Mood</div><div class="v" id="mood"></div></div>
      <div class="row"><div class="k">Avoid</div><div class="v" id="avoid"></div></div>
      <div class="mini" id="note"></div>
    </div>

    <button class="btn" id="go">Proceed to checkout →</button>
    <button class="btn secondary" id="back" type="button">Back to hearing</button>

    <p class="mini">After purchase, you’ll be redirected to your results page automatically.</p>
  </div>

  <script>
    const qp = new URLSearchParams(location.search);
    const plan = (qp.get("plan") || "explorer").toLowerCase();

    // ✅ ここをあなたのStripe Payment Linkに置換
    const STRIPE_LINK = {
      explorer: "https://buy.stripe.com/3cI14f9Axa0mbcc89NbEA01",
      connoisseur: "https://buy.stripe.com/7sY8wH7spc8u8001LpbEA02",
    };

    const noPref = qp.get("noPref") === "1";
    const areaDetails = (qp.get("areaDetails") || "").split(",").map(s=>s.trim()).filter(Boolean);

    function text(id, v){ document.getElementById(id).textContent = v; }

    text("plan", plan === "connoisseur" ? "Connoisseur" : "Explorer");

    if(noPref){
      text("pref", "—");
      text("areas", "Pick for me");
      text("who", "—");
      text("mood", "—");
      text("avoid", "—");
      text("note", "You chose “No preference — pick for me.” We’ll handle it.");
    } else {
      text("pref", qp.get("pref") || "—");
      text("areas", areaDetails.join(", ") || "—");
      text("who", qp.get("who") || "—");
      text("mood", (qp.get("mood") || "").split(",").filter(Boolean).join(", ") || "—");
      text("avoid", (qp.get("avoid") || "").split(",").filter(Boolean).join(", ") || "—");
      text("note", "These choices shape the ordering & filtering after purchase.");
    }

    document.getElementById("go").onclick = ()=>{
      // Stripeへ飛ぶ（完了後のRedirectは Stripe側で results.html?plan=...&session_id=... へ）
      location.href = STRIPE_LINK[plan] || STRIPE_LINK.explorer;
    };

    document.getElementById("back").onclick = ()=>{
      location.href = "/hearing.html?plan=" + encodeURIComponent(plan);
    };
  </script>
</body>
</html>
